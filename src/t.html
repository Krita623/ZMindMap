<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>
    const dictData = {
      '0': {
        id: '0',
        name: 'aa',
        children: [],
        _children: [],
        parent: '-1'
      }
    }

    function appendTree (id='0', level=0, list=[]) {
      const d = dictData[id]
      d.level = level
      list.push(d)
      if (d.children.length) {
        const newChildren = []
        for (const c of d.children) {
          newChildren.push(appendTree(c, level+1, list)[0])
        }
        d.children = newChildren
      } else if (d._children.length) {
        const newChildren = []
        for (const c of d._children) {
          newChildren.push(appendTree(c, level+1))
        }
        d._children = newChildren
      }
      return [d, list]
    }
    function addChild (pid, name) {
      const p = dictData[pid]
      const id = `${pid}-${p.children.length}`
      const c = {
        name,
        id,
        children: [],
        _children: [],
        parent: pid
      }
      dictData[id] = c
      dictData[pid].children.push(id)
      // console.log('dicData', dictData)
    }
    function deleteDic (id) {
      const children = dictData[id].children
      if (children.length) {
        for (const c of children) {
          deleteDic(c)
        }
      }
      delete dictData[id]
    }
    function deleteNode (id) {
      const p = dictData[dictData[id].parent]
      const pc = p.children
      const pcn = pc.filter(v => v !== id)
      dictData[dictData[id].parent].children = pcn
      deleteDic(id)
    }

    function tabNode (id, tid) {
      const nextP = dictData[tid].parent
      dictData[tid].children.push(id)

      const myP = dictData[id].parent
      dictData[myP].children = dictData[myP].children.filter(v => v !== id)
      const a = dictData[id]
    }

    function collapse (id) {
      const node = dictData[id]
      ;[node.children, node._children] = [node._children, node.children]
    }

    addChild('0', '11111')
    addChild('0', '2222')
    addChild('0', '3333')
    // console.log('appendTree', appendTree('0'))
    addChild('0-0', '11111')
    addChild('0-2', '2222')
    addChild('0-1', '3333')
    deleteNode('0-0')
    tabNode('0-2', '0-1')
    collapse('0-2')
    // deleteChild(id)

    console.log('appendTree', appendTree())
  </script>
</body>
</html>
